---
title: "Cube-rotation"
author: "Manu"
date: "17 February 2017"
output: html_document
---

```{r setup, include=FALSE}
library(magrittr)
library(igraph)
source('test.R')
knitr::opts_chunk$set(echo = TRUE)
```

## Rotation on a cube

In this article we consider a cube and the discrete rotation we can perform on it.

A cube has 6 faces and 8 vertices.

Here we try to formalize this property by introducing 3 transformations: move up, move right and rotate clockwise. Which transform the whole cube by rotating up, right and clockwise.

```{r rotations, echo = FALSE}
rot_up <- cyc(c(1, 5, 7, 3), c(2, 6, 8, 4)) %>% as.cycle
rot_right <- cyc(c(1, 2, 6, 5), c(3, 4, 8, 7)) %>% as.cycle
rot_cck <- cyc(c(1, 2, 4, 3), c(5, 6, 8, 7)) %>% as.cycle
u <- rot_up
r <- rot_right
c <- rot_cck
cat(' Rotate up', as.character(rot_up), '\r\n',
    'Rotate right', as.character(rot_right), '\r\n',
    'Rotate clockwise', as.character(rot_cck))
```

We are interested in the group R generated by these 3 global rotations. 
More elements from R the rotation group:

```{r rotation-products}
c(
  rot_right * rot_right, # order 4
  rot_right * rot_up,# p1
  rot_right * rot_cck,
  
  rot_up * rot_right,
  rot_up * rot_up, # order 4
  rot_up * rot_cck, # == p1
  
  rot_cck * rot_right, # == p1
  rot_cck * rot_up,
  rot_cck * rot_cck) # order 4

```

## Subgroup generated by the squares

Let's analyze the products. First we will analyze the squares.

```{r prod-squares, echo = FALSE}
# elements
rr <- rot_right * rot_right
uu <- rot_up * rot_up
cc <- rot_cck * rot_cck
# all the group elements
SQ2 <- c(as.word(rr/rr), rr, uu, cc)

cat('rr: ', as.character(rr %>% as.cycle), '\r\n',
    'uu: ', as.character(uu %>% as.cycle), '\r\n',
    'cc: ', as.character(cc %>% as.cycle), '\r\n', sep = '')
```

They form a group of order 4 generated by rr and uu and ~ (Z/2Z)^2. 

```{r prod-squares-structure}
# isomorphic to Z/2Z^2
all(
  rr*uu == cc, # rr and uu generate the whole group
  rr*uu == uu*rr, # they commute
  rr^2 == as.cycle(), # they are order 2
  uu^2 == as.cycle())
```

Also it is a normal subgroup of R.

```{r square-normal}
# normal subgroup
all(
  rr^u == cc,
  rr^r == rr,
  rr^c == uu,
  
  uu^u == uu,
  uu^r == cc,
  uu^c == rr
)
```

The classes of R/\<uu, rr\> include:

* \<uu, rr\>
```{r, echo = FALSE}
SQ2
```

* r\*\<uu, rr\>
```{r, echo = FALSE}
r*SQ2
```

* u\*\<uu, rr\>
```{r, echo = FALSE}
u*SQ2
```

* c\*\<uu, rr\>
```{r, echo = FALSE}
c*SQ2
```

We can add a few more classes:

* ru \* \<uu, rr\>
```{r, echo = FALSE}
r*u * SQ2
```

* (ru)^2^ \* \<uu, rr\>
```{r, echo = FALSE}
(r*u)^2 * SQ2
```

### Structure of R/SQ2

We can see that ru\*SQ2 generates a group of order 3 in R/SQ2. To show that this group is normal in R/SQ2 we need just check with the conjugation by u and r since they generate R, so their classes also generate R/SQ2:

```{r normality-ruSQ2}
all(
  (r*u)^r == (r*u)^2*uu,
  (r*u)^u == (r*u)^2*cc
)
```

So R/SQ2 can be quotiented by \<ru\*SQ2\>. It's classes are:

* \<ru\*SQ2\>
```{r, echo = FALSE}
cat('{\r\n')
SQ2
r*u*SQ2
(r*u)^2*SQ2
cat('}')
```

* r \* SQ2 \* \<ru\*SQ2\>
```{r, echo = FALSE}
cat('{\r\n')
r*SQ2
u*SQ2 # r*r*u*SQ2 == u*SQ2
c*SQ2 # r*(r*u)^2*SQ2 == c*SQ2
cat('}')
```

We verify that r\*r\*u \in u\*SQ2, r\*(r\*u)^2 \in c\*SQ2

```{r}
all(
  r*r*u == u*cc,
  r*(r*u)^2 == c*cc
  )
```

Since
1. u\*SQ2 \in r \* SQ2 \* \<ru\*SQ2\>
2. u\*SQ2 \in u \* SQ2 \* \<ru\*SQ2\>
Then r \* SQ2 \* \<ru\*SQ2\> ==  u \* SQ2 \* \<ru\*SQ2\>
Similarly r \* SQ2 \* \<ru\*SQ2\> ==  c \* SQ2 \* \<ru\*SQ2\>


So (R/SQ2)/\<ru\*SQ2\> is generated by r*\<ru\*SQ2\>.
Furthermore we have
1. r*ru\*SQ2 \in \<ru\*SQ2\>
2. r*ru\*SQ2 == u\*SQ2
2. u\*SQ2 \* u\*SQ2 == u^2\*SQ2 == SQ2
3. SQ2 \in \<ru\*SQ2\>
Then: (r\*\<ru\*SQ2\>) ^ 2 == \<ru\*SQ2\>

From this we can deduce that 
* (R/SQ2)/\<ru\*SQ2\> is isomorphic to Z/2Z.
* The elements of R/SQ2 are: SQ2, r\*SQ2, u\*SQ2, c\*SQ2, ru\*SQ2, (ru)^2\*SQ2
* R has 6*4 elements, the full list being 

```{r echo = FALSE}
R <- c(SQ2, r*SQ2, u*SQ2, c*SQ2, r*u*SQ2, ((r*u)^2)*SQ2)
R
```

We can see that R has:

```{r}
perm_orders <- permorder(c(SQ2, r*SQ2, u*SQ2, c*SQ2, r*u*SQ2, ((r*u)^2)*SQ2))
sum(perm_orders == 2)
sum(perm_orders == 4)
sum(perm_orders == 3)
cat('9 elements of order 2: \r\n')
R[c(2, 3, 4, 7, 8, 10, 12, 14, 15)]
cat('8 elements of order 3: \r\n')
R[17:24]
cat('6 elements of order 4: \r\n')
R[c(5, 6, 9, 11, 13, 16)]

```

Elements of order 2 details:
3 are square of elements of order 4:

```{r}
R[c(2, 3, 4)]
```

6 are not square of elements of order 4:

```{r}
R[c(7, 8, 10, 12, 14, 15)]
```

## Structure of R

We know that R has 24 elements and that it can be quotiented by SQ2 (isomorph to Z/2Z ^2). We know that the quotient is isomorph to S3.


$$0 \rightarrow SQ2 \rightarrow R \rightarrow S3 \rightarrow 0$$

Now we would like to know if R is a semi-direct product of SQ2 and S3.
We need to see if we can embed S3 in R such that

$$ 0 \rightarrow S3 \rightarrow R \rightarrow R/SQ2 = 0 \rightarrow R/SQ2$$

S3 is generated by an element of order 3 p and an element of order 2 a such that the action of a on p gives p2.

Let's try to find an element of order 3 in R that doesnt belong in SQ2. It turns out that there are exactly 8 elements of order 3 and that none belongs to SQ2. The list of all the elements of order 3 is:
[ru], [ru]^2

```{r all-order3}
r*u*SQ2
r*u*r*u*SQ2
```

Let's take for example r\*u. Now we need to find an element of order 2 such that (r\*u)^a = (r\*u)^2. Also a cannot belong to SQ2.

We have [inv a][ru][a] = [ru2]
We can see that [r][ru][r] = [ru2]
By going through the elements of [r] we can see that:
r\*cc is of order 2 and that it acts as we want on r\*u
```{r}
(r*u)^(r*cc) == (r*u)^2

```

The elements of this group are:
```{r, echo = FALSE}
G <- c(r/r, r*cc, (r*cc)^(r*u), r*cc^((r*u)^2), r*u, r*u*r*u)
G
```

The groups G^uu, G^rr and G^cc are also isomorphic to S3 and can also be used to form the semi-direct product.

```{r}
cat('G^uu\r\n')
G^uu
cat('G^rr\r\n')
G^rr
cat('G^cc\r\n')
G^cc
```


### Decomposition of S3

We have

$$ 0 \rightarrow Z/3Z \rightarrow S3 \rightarrow Z/2Z \rightarrow 0$$

So we also have:

$$ 0 \rightarrow Z/3Z \rightarrow R \rightarrow R/(Z/3Z) \rightarrow 0 $$
Where R/(Z/3Z) is a group of order 8.

## Subgroups of R/SQ2

We will first show that R/SQ2 is generated by r\*SQ2 and ru\*SQ2
Then we will show that it is isomorphic to S3.

### R/SQ2 is generated by r\*SQ2 and ru\*SQ2
[r]*[ru] = [r2][u] = [u]
[r]*[ruru] = [rr][uru] = [uru] = [uru][rr] = [ururr] = [c]

### R/SQ2 is isomorphic to S3
We will prove it using relations on the generators.
[r]^2 = [rr] = [e]
[ru]^3 = [e]
[ru]^[r] = [r-1rur] = [(ru)^2]

We know that [r] and [ru] generates R/SQ2. We know the group generated by each. We know that [ru] is normal. And we know the action of [r] on [ru]. Since all these are true for S3 as well and the action is the same we deduce that the groups are isomorphic.

```{r echo = FALSE}
all((r*u)^r == (r*u)^2*uu)
```

So we can break the subgroups of R into 3 category:
1. The subgroups of R that are included in SQ2
2. The subgroups of R that contain SQ2
3. The rest

Since SQ2 is isomorphic to Z/2Z * Z/2Z it has 3 non-trivial subgroups:
```{r subgroup-graph, echo = FALSE}
g <- make_empty_graph() +
  vertex('R') +
  # subgroups of SQ2
  vertex('SQ2') +
  vertex('uu') + 
  vertex('rr') + 
  vertex('cc') +
  vertex('e') +
  path('e', 'uu', 'SQ2', 'R') +
  path('e', 'rr', 'SQ2') + 
  path('e', 'cc', 'SQ2')
plot(g)
```

The subgroups of R that contain SQ2 are isomorphic to the subgroups of R/SQ2.
Since R/SQ2 is isomorphic to S3 it has 4 non-trivial subgroups which are generated respectively by [r], [u], [c], [ur].

```{r subgroups-containingSQ2}
g <- make_empty_graph() +
  vertex('R') +
  # subgroups of SQ2
  vertex('SQ2 U uSQ2') + 
  vertex('SQ2 U rSQ2') + 
  vertex('SQ2 U cSQ2') +
  vertex('SQ2 U ruSQ2 U (ru)2SQ2') +
  vertex('SQ2') +
  path('SQ2', 'SQ2 U uSQ2', 'R') +
  path('SQ2', 'SQ2 U rSQ2', 'R') + 
  path('SQ2', 'SQ2 U cSQ2', 'R') +
  path('SQ2', 'SQ2 U ruSQ2 U (ru)2SQ2', 'R')
plot(g)
```

Now let's analyze the subgroups which are neither included in SQ2 nor including SQ2.

We can separate in 2. Those whose intersection with SQ2 is {e} and those whose intersection with SQ2 is not {e} and not SQ2.

### Subgroups whose intersection with SQ2 is {e}

Let H be such a group. The image of H by $R \rightarrow R/SQ2$ is a subgroug of R/SQ2 which is isomorphic to S3. Since $H \inter SQ2 = {e}$ The restriction of the projection into R/SQ2 to H is an injection since the intersection with SQ2 is trivial. So H is isomorphic with a subgroup of S3.

## Subgroup generated by the products of order 3

Now let's analyze the other products: we have 4 distincts products that all have order 3. We analyze the group they generate.

```{r prod-order3}
ru <- rot_right * rot_up
rc <- rot_right * rot_cck
ur <- rot_up * rot_right
cu <- rot_cck * rot_up

ru2 <- ru*ru
rc2 <- rc*rc
ur2 <- ur*ur
cu2 <- cu*cu

all(c(
  ru*rc == rr,
  ru*ur == uu,
  ru*cu == cc,
  
  rc*ru == cc,
  rc*ur == ru,
  rc*cu == ur^2,
  
  ur*rc == cu^2,
  ur*ru == rr,
  ur*cu == ru,
  
  cu*rc == ru,
  cu*ur == rc^2,
  cu*ru == uu
))
```

We can see that the following elements all belong to the group generated by all the products of order 3:
e, uu, rr, cc,
ru, rc, ur, cu
ur2, rc2, cu2, ru2

Let's compute the orbits of <uu, rr> on that group (it is a normal subgroup)
{e, uu, rr, cc}, {ru, ur2, rc2, cu2}, {rc, ur, cu, ru2}. The quotient group is generated by the classes of the generators so we deduce that these classes are the quotient group and that it is isomorphic to Z/3Z.

The group <ru, ur, cu, ru> will be noted C3. C3 can be projected into Z/3Z with a kernel equal to Z/2Z^2. C3 is of order 12 and non-commutative. We need to specify the action of Z/3Z on Z/2Z^2. For this we need just specify the action of ru on the orbits, since ru*N generates the quotient group.

```{r action of C3 on N}
e <- as.cycle() %>% as.word # identity
# all the elements of C3
C3 <- c(
  e, uu, rr, cc,
  ru, ur2, rc2, cu2,
  rc, ur, cu, ru2)
all(
  uu^ru == rr,
  rr^ru == cc,
  cc^ru == uu
)
```

C3 is normal in R. C3 is generated by uu, rr and ru. Since <uu, rr> is already normal in R we just need to show that ru is mapped to an element of C3 by conjugation by the generators of R.

```{r C3-normal-in-R}
all(
  ru^u == cu,
  ru^r == ur,
  ru^c == rc
)
```

Now we will try to find the classes of R by C3. Let's start with the classes of the generators of C3:

e*C3 = {e, uu, rr, cc,
        ru, ur2, rc2, cu2,
        rc, ur, cu, ru2}
u*C3 = {u, u^3, urr, ucc, 
        uru, u2r2, urc2, ucu2,
        urc, u2r, ucu, uru2}
r*C3 = {r, ruu, r3, rcc,
        r2u, rur2, r2c2, rcu2,
        r2c, rur, rcu, r2u2}
c*C3 = {c, cuu, crr, c3,
        cru, cur2, crc2, cu2,
        crc, cur, c2u, cru2}

We can see that the uC3 == rC3 == cC3 because:
```{r R_div_C3}
all(u*rc == r, u*ur^2 == c)
```

So we deduce that R is a semi-direct product of Z/2Z x C3. R has 24 elements. And it is generated by <u, rr, ru> or just <u, r>
The action of Z/2Z on C3 is given by:

(e) (uu) (rr cc) (ru cu rc2 ur) (ur2 ru2 cu2 rc)
```{r R_action_on_C3}
all(c(
  e^u == e, uu^u == uu, rr^u == cc, cc^u == rr,
  ru^u == cu, ur2^u == ru2, rc2^u == ur, cu2^u == rc,
  rc^u == ur2, ur^u == ru, cu^u == rc2, ru2^u == cu2
))
```

# Actions of R

We observe the following relations between the generators.

```{r rot-relations}
all(
  rot_right ^ rot_up == rot_cck,
  rot_right ^ rot_cck == rot_up^-1,

  rot_up ^ rot_right == rot_cck^-1,
  rot_up ^ rot_cck == rot_right,

  rot_cck ^ rot_right == rot_up,
  rot_cck ^ rot_up == rot_right^-1)
```

Those relations define an action of the group R in the set {rot_up, rot_right, rot_cck, rot_up^-1, rot_right^-1, rot_cck^-1} that we note {1, 2, 3, 4, 5, 6}.

The image of this group action is generated by:

```{r group-action, echo = FALSE}
act_u <- cyc(c(2, 3, 5, 6)) %>% as.cycle
act_r <- cyc(c(1, 6, 4, 3)) %>% as.cycle
act_c <- cyc(c(1, 2, 4, 5)) %>% as.cycle

cat('a_u', as.character(act_u), '\r\n',
    'a_r', as.character(act_r), '\r\n',
    'a_c', as.character(act_c), sep = '')
```

The group generated by all the squares of these elements is a normal subgroup:

```{r normal-subgroup}
#a <- act_u^2 
#b <- act_r^2
#c2 <- act_c^2

#all(a^act_u == a, a^act_r == c, a^act_c == b,
#  b^act_u == c, b^act_r == b, b^act_c == a,
#  c^act_u == b, c^act_r == a, c^act_c == c)
```

As a\*b == c and a\*b == b\*a we have N ~ <a> x <b> ~ Z/2Z^2.
N = {e, a, b, ab}

The orbits of N on {1,2,3,4,5,6} are {{1, 4}, {2, 5}, {3, 6}}. That we note {1, 2, 3}. The original group action A acts on these orbits by the following action:

```{r quotient}
act_uq <- cyc(c(2,3)) %>% as.cycle
act_rq <- cyc(c(1,3)) %>% as.cycle
act_cck <- cyc(c(1,2)) %>% as.cycle
```

So we get a morphism of A into S3 that is a surjection and N is in the kernel.

So the action of the group on N is isomorphic to S3. So A is a product of S3 by (Z/2Z)^2.

